<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <title>Admin Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="/css/dashboard.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <div th:fragment="content">
        <div class="container-fluid dashboard-content">
            <!-- Toggle Buttons -->
            <div class="row mb-4">
                <div class="col-3"></div>
                <div class="col-6 text-center">
                    <div class="btn-group" role="group">
                        <input type="radio" class="btn-check" name="viewType" id="usersView" checked>
                        <label class="btn btn-outline-primary" for="usersView">
                            <i class="fas fa-users"></i> Users
                        </label>
                        
                        <input type="radio" class="btn-check" name="viewType" id="rentalsView">
                        <label class="btn btn-outline-primary" for="rentalsView">
                            <i class="fas fa-home"></i> Rentals
                        </label>
                    </div>
                </div>
                <div class="col-3"></div>
            </div>

            <div class="row">
                <!-- Left Sidebar with Filters -->
                <div class="col-xl-3">
                    <div class="filter-card">
                        <div class="filter-header">
                            <h4><i class="fas fa-filter"></i> Filters</h4>
                        </div>
                        
                        <!-- Users Filter Section -->
                        <div class="filter-section" id="usersFilterSection">
                            <h5 class="filter-title">Verification Status</h5>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="VERIFIED" id="statusVerified" checked>
                                <label class="form-check-label status-label verified" for="statusVerified">
                                    <i class="fas fa-check-circle"></i> Verified
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="UNVERIFIED" id="statusUnverified" checked>
                                <label class="form-check-label status-label unverified" for="statusUnverified">
                                    <i class="fas fa-times-circle"></i> Unverified
                                </label>
                            </div>

                            <h5 class="filter-title mt-4">User Type</h5>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="LANDLORD" id="typeLandlord" checked>
                                <label class="form-check-label" for="typeLandlord">
                                    <i class="fas fa-user-tie"></i> Landlord
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="TENANT" id="typeTenant" checked>
                                <label class="form-check-label" for="typeTenant">
                                    <i class="fas fa-user"></i> Tenant
                                </label>
                            </div>

                            <!-- User Search -->
                            <div class="filter-section">
                                <h5 class="filter-title">Search User</h5>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="userSearch" placeholder="Enter username...">
                                    <button class="btn btn-outline-primary" type="button" id="searchUserBtn">
                                        <i class="fas fa-search"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Rentals Filter Section -->
                        <div class="filter-section" id="rentalsFilterSection" style="display: none;">
                            <h5 class="filter-title">Verification Status</h5>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="VERIFIED" id="rentalVerified" checked>
                                <label class="form-check-label status-label verified" for="rentalVerified">
                                    <i class="fas fa-check-circle"></i> Verified
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="UNVERIFIED" id="rentalUnverified" checked>
                                <label class="form-check-label status-label unverified" for="rentalUnverified">
                                    <i class="fas fa-times-circle"></i> Unverified
                                </label>
                            </div>

                            <!-- Rental Search -->
                            <div class="filter-section">
                                <h5 class="filter-title">Search by ID</h5>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="rentalSearch" placeholder="Enter rental ID...">
                                    <button class="btn btn-outline-primary" type="button" id="searchRentalBtn">
                                        <i class="fas fa-search"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Main Content Area -->
                <div class="col-xl-9">
                    <div class="content-card">
                        <div class="content-header">
                            <h2><i class="fas fa-shield-alt"></i> Admin Dashboard</h2>
                        </div>
                        <div id="dashboardContent">
                            <!-- Content will be loaded dynamically -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts Fragment -->
    <th:block th:fragment="scripts">
        <style>
            .btn.btn-outline-primary.hover-primary:hover {
                color: #fff;
                background-color: var(--bs-primary);
                border-color: var(--bs-primary);
            }
            .status-label.verified {
                color: #28a745;
            }
            .status-label.unverified {
                color: #dc3545;
            }
        </style>
        <script th:inline="javascript">
            document.addEventListener('DOMContentLoaded', function() {
                // View type change handlers
                const viewButtons = document.querySelectorAll('input[name="viewType"]');
                const usersFilterSection = document.getElementById('usersFilterSection');
                const rentalsFilterSection = document.getElementById('rentalsFilterSection');

                viewButtons.forEach(button => {
                    button.addEventListener('change', function() {
                        if (this.id === 'usersView') {
                            usersFilterSection.style.display = 'block';
                            rentalsFilterSection.style.display = 'none';
                        } else if (this.id === 'rentalsView') {
                            usersFilterSection.style.display = 'none';
                            rentalsFilterSection.style.display = 'block';
                        }
                        updateDashboard();
                    });
                });

                // Initial view setup
                const currentView = document.querySelector('input[name="viewType"]:checked');
                if (currentView) {
                    currentView.dispatchEvent(new Event('change'));
                }

                // Search handlers
                document.getElementById('searchUserBtn').addEventListener('click', function() {
                    const searchTerm = document.getElementById('userSearch').value;
                    if (searchTerm) {
                        searchUsers(searchTerm);
                    }
                });

                document.getElementById('searchRentalBtn').addEventListener('click', function() {
                    const searchTerm = document.getElementById('rentalSearch').value;
                    if (searchTerm) {
                        searchRentals(searchTerm);
                    }
                });

                // Enter key handlers for search inputs
                document.getElementById('userSearch').addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        document.getElementById('searchUserBtn').click();
                    }
                });

                document.getElementById('rentalSearch').addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        document.getElementById('searchRentalBtn').click();
                    }
                });

                function updateDashboard() {
                    const isUsersView = document.getElementById('usersView').checked;
                    const filters = {
                        verified: [],
                        userTypes: [],
                        searchTerm: ''
                    };

                    if (isUsersView) {
                        if (document.getElementById('statusVerified').checked) filters.verified.push('VERIFIED');
                        if (document.getElementById('statusUnverified').checked) filters.verified.push('UNVERIFIED');
                        if (document.getElementById('typeLandlord').checked) filters.userTypes.push('LANDLORD');
                        if (document.getElementById('typeTenant').checked) filters.userTypes.push('TENANT');
                        filters.searchTerm = document.getElementById('userSearch').value;
                    } else {
                        if (document.getElementById('rentalVerified').checked) filters.verified.push('VERIFIED');
                        if (document.getElementById('rentalUnverified').checked) filters.verified.push('UNVERIFIED');
                        filters.searchTerm = document.getElementById('rentalSearch').value;
                    }

                    // Call backend API with filters
                    fetchDashboardData(isUsersView ? 'users' : 'rentals', filters);
                }

                function fetchDashboardData(type, filters) {
                    // TODO: Implement API call to fetch dashboard data
                    console.log('Fetching', type, 'with filters:', filters);
                }

                function searchUsers(username) {
                    // TODO: Implement user search
                    console.log('Searching for user:', username);
                }

                function searchRentals(id) {
                    // TODO: Implement rental search
                    console.log('Searching for rental:', id);
                }

                // Add event listeners to all checkboxes for automatic updates
                document.querySelectorAll('.filter-section input[type="checkbox"]').forEach(checkbox => {
                    checkbox.addEventListener('change', updateDashboard);
                });
            });
        </script>
    </th:block>
</body>
</html>
